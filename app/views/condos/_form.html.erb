<%= render "shared/errors", model: @condo %>

<%= form_with(model: @condo) do |f| %>
  <div class="form-row d-flex p-2">
    <div class="form-group col-md-6 pe-3">
      <%= f.label :name %>
      <%= f.text_field :name, class:"form-control" %>
    </div>
    <div class="form-group col-md-6">
      <%= f.label :registration_number %>
      <%= f.text_field :registration_number, class:"form-control", placeholder: "00.111.222/3333-44" ,
          maxlength: "18", onkeyup:"RegistrationNumberPressed(event)" %>
    </div>
  </div>
  <div>
    <%= f.fields_for :address, @condo.address || Address.new do |address_f| %>
    
      <div class="form-row d-flex p-2">
        <div class="form-group col-md-6 pe-3">
          <%= address_f.label :public_place %>
          <%= address_f.text_field :public_place, class:"form-control" %>
        </div>
        <div class="form-group col-md-2 pe-3">
          <%= address_f.label :number %>
          <%= address_f.text_field :number, class:"form-control" %>
        </div>
        <div class="form-group col-md-4 pe-3">
          <%= address_f.label :neighborhood %>
          <%= address_f.text_field :neighborhood, class:"form-control" %>
        </div>
      </div>

      <div class="form-row d-flex p-2">
        <div class="form-group col-md-6 pe-3">
          <%= address_f.label :city %>
          <%= address_f.text_field :city, class:"form-control"  %>
        </div>
        <div class="form-group col-md-2 pe-3">
          <%= address_f.label :state %>
          <%= address_f.select :state, options_for_select(Address::STATES), {}, class:"form-control form-select" %>
        </div>
        <div class="form-group col-md-4 pe-3">
          <%= address_f.label :zip %>
          <%= address_f.text_field :zip, class:"form-control", placeholder: "12345-678" ,maxlength: "9", onkeyup: "zipPressed(event)"  %>
        </div>
      </div>
    <% end %>

    <%= f.submit 'Salvar', class:"btn btn-dark" %>

  </div>

  
<% end %>


<script>

function RegistrationNumberPressed(event){
  let button = event.target
  button.value = RegistrationNumberMask(button.value)
}

function RegistrationNumberMask(value){
  return value
      .replace(/\D/g, '')
      .replace(/(\d{2})(\d+)/, '$1.$2')
      .replace(/(\d{3})(\d+)/, '$1.$2')
      .replace(/(\d{3})(\d+)/, '$1/$2')
      .replace(/(\d{4})(\d+)/, '$1-$2')
      .replace(/(-\d{2})\d+$/, '$1')
}


function zipPressed(event){
  let button = event.target
  button.value = zipCodeMask(button.value)
}

function zipCodeMask(value){
  return value
      .replace(/\D/g, '')
      .replace(/(\d{5})(\d)/, '$1-$2')
      .replace(/(\d{5}-\d{3})/, '$1')
      .replace(/(-\d{3})\d+$/, '$1')
}

</script>